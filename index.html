<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yoshiko Delivery</title>
    
    <!-- Telegram Web App Script -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- Tailwind CSS (для стилей) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    
    <!-- Babel (чтобы браузер понял React код) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Скрываем скроллбар, но оставляем скролл */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* Анимации */
        .tap-effect:active {
            transform: scale(0.95);
        }
        body {
            -webkit-tap-highlight-color: transparent;
            background-color: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        // --- ИКОНКИ (SVG) ---
        // Чтобы не зависеть от внешних библиотек, я встроил иконки прямо сюда.
        const IconCart = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>;
        const IconPlus = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>;
        const IconMinus = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/></svg>;
        const IconSearch = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>;
        const IconFood = () => <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/></svg>;

        // --- ДАННЫЕ МЕНЮ (Из ваших файлов) ---
        const MENU_DATA = {
            sets: {
                title: "Сеты",
                items: [
                    { id: 'set-newyork', name: 'Сет Нью-Йорк', weight: '1320 гр', count: '48 шт', price: 2400, description: 'Роллы: Каприз, Шеф, Дунай, Жемчужина, Саппоро, Майами' },
                    { id: 'set-fuji', name: 'Сет Фуджи', weight: '900 гр', count: '32 шт', price: 1350, description: 'Роллы: Йоджи маки, Белоснежка, Чикаго, Ролл с креветкой' },
                    { id: 'set-oslo', name: 'Сет Осло', weight: '1740 гр', count: '56 шт', price: 3100, description: 'Черный самурай, Спай эби, Шик маки, Золотой, Сой бин маки' },
                    { id: 'set-furshet', name: 'Сет Фуршет', weight: '2200 гр', count: '80 шт', price: 4100, description: 'Шанхай, Корона, Белоснежка, Калифорния с кунжутом, Де люкс, Аляска' },
                    { id: 'set-vip', name: 'Сет ВИП', weight: '850 гр', count: '27 шт', price: 1790, description: 'Роллы: Мадрид, Тар-тар маки, Бангкок. Суши: Угорь, Лосось' },
                    { id: 'set-texas', name: 'Сет Техас', weight: '1300 гр', count: '40 шт', price: 2050, description: 'Темпура: маки, императорский. Роллы: сидней, кайсен, черный самурай' }
                ]
            },
            rolls: {
                title: "Роллы",
                items: [
                    { id: 'roll-philadelphia', name: 'Филадельфия', weight: '200 гр', price: 480, description: 'Лосось, сливочный сыр' },
                    { id: 'roll-california', name: 'Калифорния', weight: '200 гр', price: 430, description: 'Креветка, авокадо, тобико, японский майонез' },
                    { id: 'roll-canada', name: 'Канада', weight: '200 гр', price: 430, description: 'Угорь, лосось копчёный, авокадо, филадельфия, кунжут' },
                    { id: 'roll-dragon', name: 'Золотой дракон', weight: '230 гр', price: 660, description: 'Королевская креветка, угорь, паприка, филадельфия' },
                    { id: 'roll-moscow', name: 'Москва', weight: '210 гр', price: 430, description: 'Копченый лосось, филадельфия, огурец, икра' },
                    { id: 'roll-black-samurai', name: 'Черный самурай', weight: '200 гр', price: 430, description: 'Филадельфия, тобико чёрное, угорь, креветка, огурец' }
                ]
            },
            sushirrito: {
                title: "Суширитто",
                items: [
                    { id: 'sushirrito-flow', name: 'РоллФлоу', weight: '330 гр', price: 550, description: 'Когда всё идёт само: работа спорится, настроение на пике' },
                    { id: 'sushirrito-caesar', name: 'Цезарь в кляре', weight: '330 гр', price: 510, description: 'Сытный микс любимого салата и японского формата' },
                    { id: 'sushirrito-satori', name: 'Суширитто сатори', weight: '310 гр', price: 570, description: 'Философы веками спорят о смысле жизни, а можно просто съесть это' }
                ]
            },
            street: {
                title: "СтритФуд",
                items: [
                    { id: 'burger-bbq', name: 'Бургер Барбекю', weight: '285 гр', price: 410, description: 'Булочка с кунжутом, мраморная говядина, вьетнамский лук' },
                    { id: 'burger-black-deluxe', name: 'Блэк бургер Делюкс', weight: '420 гр', price: 500, description: 'Черная булочка, мраморная говядина, салат Айсберг' },
                    { id: 'taco-beef', name: 'Тако Биф спайси', weight: '325 гр', price: 420, description: 'Тортилья, говяжий фарш, помидор, перец болгарский' },
                    { id: 'quesadilla-cheese', name: 'Кесадилья Чиз Тайм', weight: '190 гр', price: 360, description: 'Тортилья, моцарелла, сметана, соус сливочно-чесночный' },
                    { id: 'burrito-mexican', name: 'Мексиканский буррито', weight: '420 гр', price: 430, description: 'Пшеничная тортилья, фарш из мраморной говядины, картофель фри' }
                ]
            },
            pizza: {
                title: "Пицца",
                items: [
                    { id: 'pizza-peperoni', name: 'Пепперони', price: 420, description: 'Пицца-соус, сыр Моцарелла, пепперони, шампиньоны' },
                    { id: 'pizza-margarita', name: 'Маргарита', price: 450, description: 'Пицца-соус, сыр Моцарелла, помидоры' },
                    { id: 'pizza-tom-yam', name: 'Том Ям', price: 690, description: 'Встреча итальянской классики с азиатской страстью' },
                    { id: 'pizza-4-cheese', name: '4 Сыра', price: 420, description: 'Моцарелла, дорблю, мимолет, Пармезан' },
                    { id: 'pizza-chicken', name: 'Куриная', price: 430, description: 'Сливочный соус, сыр моцарелла, куриное филе' },
                    { id: 'pizza-caesar', name: 'Цезарь', price: 410, description: 'Соус цезарь, сыр Моцарелла, куриная грудка, салат айсберг, помидоры' }
                ]
            },
            wok: {
                title: "WOK",
                items: [
                    { id: 'wok-udon-chicken', name: 'Удон с курицей', price: 380, description: 'Лапша удон, куриная грудка, грибы шиитаке, перец' },
                    { id: 'wok-soba-seafood', name: 'Соба с морепродуктами', price: 380, description: 'Гречневая лапша, кальмар, мидии, осьминог' },
                    { id: 'wok-tom-yam-pasta', name: 'Паста Том Ям с курицей', price: 410, description: 'Когда жизнь кажется слишком пресной, закажи эту пасту' },
                    { id: 'wok-harusame-chicken', name: 'Харусаме с курицей', price: 420, description: 'Рисовая лапша, овощи, куриная грудка' }
                ]
            },
            poke: {
                title: "Поке",
                items: [
                    { id: 'poke-salmon', name: 'Поке с лососем', weight: '350 гр', price: 650, description: 'Гавайцы - умные люди. Зачем вилки и ножи?' },
                    { id: 'poke-shrimp', name: 'Поке с креветками', weight: '350 гр', price: 650, description: 'Креветки - продукт тонкий, легко испортить' },
                    { id: 'poke-tuna', name: 'Поке с тунцом', weight: '350 гр', price: 650, description: 'Карибская пристань в полдень, крики чаек, запах соли' }
                ]
            },
            soup: {
                title: "Супы",
                items: [
                    { id: 'soup-tom-yam', name: 'Суп Том Ям', price: 410, description: 'Это как первое свидание: сначала непонятно, потом остро' },
                    { id: 'soup-miso', name: 'Мисо суп', price: 240, description: 'Классика японской кухни. Простой, как дзен-сад' },
                    { id: 'soup-cream-mushroom', name: 'Крем суп грибной', price: 270, description: 'Создан для прохладных вечеров' },
                    { id: 'soup-salmon', name: 'Суп с лососем', price: 370, description: 'Мисо-суп с характером - здесь главную роль играет лосось' }
                ]
            },
            yakitori: {
                title: "Шашлычки",
                items: [
                    { id: 'yakitori-chicken', name: 'Шашлычки из курицы', weight: '2 шт', price: 240, description: 'Сочные кусочки в соусе унаги' },
                    { id: 'yakitori-salmon', name: 'Шашлычки из семги', weight: '2 шт', price: 330, description: 'Утонченность, бархат ночи, капля волшебства' },
                    { id: 'yakitori-hearts', name: 'Куриные сердечки', weight: '2 шт', price: 220, description: 'Шашлычок-Оскар, не меньше! На красной дорожке вкусов' }
                ]
            },
            ossetian: {
                title: "Пироги",
                items: [
                    { id: 'pie-meat', name: 'С мясом', weight: '700 гр', price: 750, description: 'Говяжий фарш, лук, чили перец, чеснок' },
                    { id: 'pie-cheese', name: 'С сыром', weight: '700 гр', price: 640, description: 'Сыр «Осетинский», масло топленое' },
                    { id: 'pie-potato', name: 'С картофелем и грибами', weight: '700 гр', price: 580, description: 'Мука в/с, грибы, картофель, сыр' }
                ]
            },
             combo: {
                title: "Комбо",
                items: [
                    { id: 'combo-shanghai', name: 'Комбо Шанхай', price: 590, description: 'Вопрос «Что бы поесть?» решается на ура!' },
                    { id: 'combo-5-pizzas', name: 'Комбо "5 Пицц"', price: 2350, description: 'Пять разных историй на одном столе' },
                    { id: 'combo-nevada', name: 'Комбо Невада', price: 590, description: 'Сытный набор для тех, кто ценит вкус и разнообразие' }
                ]
            },
            desserts: {
                title: "Десерты",
                items: [
                    { id: 'cheesecake-classic', name: 'Чизкейк Классик', price: 220, description: 'Нью-йоркский чизкейк - плотный, сливочный' },
                    { id: 'roll-victoria', name: 'Сладкий ролл Виктория', price: 340, description: 'Яркий, сочный, немного королевский' },
                    { id: 'tiramisu', name: 'Тирамису', price: 220, description: 'Итальянский десерт, «подними меня вверх»' }
                ]
            },
            sushi: {
                title: "Суши",
                items: [
                    { id: 'sushi-salmon', name: 'Суши с лососем', price: 120, description: 'Лосось, рис' },
                    { id: 'sushi-eel', name: 'Суши с угрем', price: 140, description: 'Угорь, соус унаги, кунжут' },
                    { id: 'sushi-tuna', name: 'Суши с тунцом', price: 120, description: 'Тунец, рис' }
                ]
            },
            drinks: {
                title: "Напитки",
                items: [
                    { id: 'drink-dobry-cola', name: 'Добрый Кола', volume: '1.0 л', price: 190, description: '' },
                    { id: 'drink-adrenaline', name: 'Адреналин Раш', volume: '0.5 л', price: 200, description: '' },
                    { id: 'drink-orange', name: 'Добрый Апельсин', volume: '1.0 л', price: 210, description: '' }
                ]
            }
        };

        const CATEGORIES = Object.keys(MENU_DATA).map(key => ({
            id: key,
            label: MENU_DATA[key].title
        }));

        // --- ГЛАВНЫЙ КОМПОНЕНТ ---
        const App = () => {
            const [activeCategory, setActiveCategory] = useState(CATEGORIES[0].id);
            const [cart, setCart] = useState({});
            const [view, setView] = useState('menu'); // 'menu' | 'cart'
            const [searchQuery, setSearchQuery] = useState('');

            // Инициализация Telegram
            useEffect(() => {
                if (window.Telegram && window.Telegram.WebApp) {
                    const tg = window.Telegram.WebApp;
                    tg.ready();
                    tg.expand();
                    
                    // Цвета
                    document.documentElement.style.setProperty('--tg-theme-bg-color', tg.themeParams.bg_color || '#ffffff');
                    document.documentElement.style.setProperty('--tg-theme-text-color', tg.themeParams.text_color || '#000000');
                }
            }, []);

            const totalAmount = useMemo(() => {
                return Object.values(cart).reduce((sum, item) => sum + (item.price * item.quantity), 0);
            }, [cart]);

            const handleCheckout = useCallback(() => {
                if (window.Telegram && window.Telegram.WebApp) {
                    const tg = window.Telegram.WebApp;
                    const itemsList = Object.values(cart)
                        .map(item => `${item.name} x${item.quantity} - ${item.price * item.quantity}₽`)
                        .join('\n');
                    const message = `Новый заказ!\n\n${itemsList}\n\nИтого: ${totalAmount} ₽`;
                    tg.sendData(JSON.stringify({ cart, totalAmount, message }));
                } else {
                    alert(`Заказ на сумму ${totalAmount} ₽ (В Telegram это отправится боту)`);
                }
            }, [cart, totalAmount]);

            // Кнопка MainButton
            useEffect(() => {
                if (window.Telegram && window.Telegram.WebApp) {
                    const tg = window.Telegram.WebApp;
                    if (totalAmount > 0) {
                        tg.MainButton.text = `ЗАКАЗАТЬ: ${totalAmount} ₽`;
                        tg.MainButton.show();
                        tg.MainButton.onClick(handleCheckout);
                    } else {
                        tg.MainButton.hide();
                        tg.MainButton.offClick(handleCheckout);
                    }
                }
                return () => {
                     if (window.Telegram && window.Telegram.WebApp) {
                        window.Telegram.WebApp.MainButton.offClick(handleCheckout);
                     }
                }
            }, [totalAmount, handleCheckout]);

            const handleAddToCart = (item) => {
                setCart(prev => {
                    const currentQty = prev[item.id]?.quantity || 0;
                    return { ...prev, [item.id]: { ...item, quantity: currentQty + 1 } };
                });
                if (window.Telegram?.WebApp?.HapticFeedback) {
                    window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
                }
            };

            const handleRemoveFromCart = (item) => {
                setCart(prev => {
                    const currentQty = prev[item.id]?.quantity || 0;
                    if (currentQty <= 1) {
                        const newCart = { ...prev };
                        delete newCart[item.id];
                        return newCart;
                    }
                    return { ...prev, [item.id]: { ...item, quantity: currentQty - 1 } };
                });
            };

            const getFilteredItems = () => {
                if (searchQuery) {
                    return Object.values(MENU_DATA)
                        .flatMap(cat => cat.items)
                        .filter(item => item.name.toLowerCase().includes(searchQuery.toLowerCase()));
                }
                return MENU_DATA[activeCategory].items;
            };

            // Цвета темы
            const secondaryBg = window.Telegram?.WebApp?.themeParams?.secondary_bg_color || '#f3f4f6';
            const accentColor = window.Telegram?.WebApp?.themeParams?.button_color || '#eab308';
            const buttonText = window.Telegram?.WebApp?.themeParams?.button_text_color || '#ffffff';

            return (
                <div className="min-h-screen pb-24 font-sans">
                    
                    {/* Header */}
                    <div className="sticky top-0 z-50 backdrop-blur-md bg-opacity-90 border-b border-gray-200"
                         style={{ backgroundColor: 'var(--tg-theme-bg-color)' }}>
                        <div className="px-4 py-3 flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <div className="w-8 h-8 rounded-full flex items-center justify-center font-bold text-white"
                                     style={{ backgroundColor: accentColor }}>Y</div>
                                <h1 className="text-xl font-bold">Yoshiko</h1>
                            </div>
                            <div className="relative cursor-pointer tap-effect" onClick={() => setView(view === 'cart' ? 'menu' : 'cart')}>
                                <IconCart />
                                {Object.keys(cart).length > 0 && (
                                    <span className="absolute -top-2 -right-2 bg-red-500 text-white text-[10px] font-bold rounded-full w-5 h-5 flex items-center justify-center border-2 border-white">
                                        {Object.values(cart).reduce((a,b) => a + b.quantity, 0)}
                                    </span>
                                )}
                            </div>
                        </div>

                        {/* Search */}
                        {view === 'menu' && (
                            <div className="px-4 pb-2">
                                <div className="relative">
                                    <div className="absolute left-3 top-2.5 opacity-50"><IconSearch /></div>
                                    <input 
                                        type="text" 
                                        placeholder="Найти роллы, пиццу..." 
                                        value={searchQuery}
                                        onChange={(e) => setSearchQuery(e.target.value)}
                                        className="w-full pl-10 pr-4 py-2 rounded-xl text-sm outline-none transition-all"
                                        style={{ backgroundColor: secondaryBg, color: 'var(--tg-theme-text-color)' }}
                                    />
                                </div>
                            </div>
                        )}

                        {/* Categories */}
                        {view === 'menu' && !searchQuery && (
                            <div className="flex overflow-x-auto hide-scrollbar px-4 pb-3 gap-2">
                                {CATEGORIES.map(cat => (
                                    <button
                                        key={cat.id}
                                        onClick={() => setActiveCategory(cat.id)}
                                        className={`whitespace-nowrap px-4 py-2 rounded-full text-sm font-medium transition-all tap-effect ${
                                            activeCategory === cat.id ? 'shadow-md' : 'opacity-70'
                                        }`}
                                        style={{
                                            backgroundColor: activeCategory === cat.id ? accentColor : secondaryBg,
                                            color: activeCategory === cat.id ? buttonText : 'var(--tg-theme-text-color)'
                                        }}
                                    >
                                        {cat.label}
                                    </button>
                                ))}
                            </div>
                        )}
                    </div>

                    {/* Content */}
                    <div className="p-4">
                        {view === 'menu' ? (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {searchQuery && <h2 className="text-lg font-bold mb-2 col-span-full">Результаты поиска:</h2>}
                                {getFilteredItems().map(item => (
                                    <div key={item.id} className="rounded-2xl p-4 flex gap-4 shadow-sm border border-transparent transition-all"
                                         style={{ backgroundColor: secondaryBg }}>
                                        <div className="w-24 h-24 rounded-xl bg-gray-200 flex-shrink-0 flex items-center justify-center text-gray-400">
                                            <IconFood />
                                        </div>
                                        <div className="flex-1 flex flex-col justify-between">
                                            <div>
                                                <h3 className="font-bold text-base leading-tight mb-1">{item.name}</h3>
                                                <p className="text-xs opacity-60 line-clamp-2 mb-2">{item.description}</p>
                                                {item.weight && <span className="text-[10px] font-medium px-2 py-0.5 rounded opacity-50 bg-gray-300 text-black inline-block">{item.weight}</span>}
                                            </div>
                                            <div className="flex items-center justify-between mt-2">
                                                <span className="font-bold text-lg">{item.price} ₽</span>
                                                
                                                {cart[item.id] ? (
                                                    <div className="flex items-center rounded-full bg-white dark:bg-black bg-opacity-10">
                                                        <button onClick={() => handleRemoveFromCart(item)} className="p-2 tap-effect"><IconMinus /></button>
                                                        <span className="px-1 font-medium text-sm">{cart[item.id].quantity}</span>
                                                        <button onClick={() => handleAddToCart(item)} className="p-2 tap-effect"><IconPlus /></button>
                                                    </div>
                                                ) : (
                                                    <button onClick={() => handleAddToCart(item)}
                                                            className="px-4 py-1.5 rounded-xl font-semibold text-sm shadow-sm tap-effect"
                                                            style={{ backgroundColor: accentColor, color: buttonText }}>
                                                        + Добавить
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div className="space-y-4">
                                <div className="flex items-center justify-between mb-4">
                                    <h2 className="text-2xl font-bold">Корзина</h2>
                                    <button onClick={() => setCart({})} className="text-red-500 text-sm font-medium">Очистить</button>
                                </div>
                                {Object.keys(cart).length === 0 ? (
                                    <div className="text-center py-20 opacity-50">
                                        <div className="flex justify-center mb-4"><IconCart /></div>
                                        <p>Корзина пуста</p>
                                        <button onClick={() => setView('menu')} className="mt-4 text-blue-500 font-medium">Перейти в меню</button>
                                    </div>
                                ) : (
                                    Object.values(cart).map(item => (
                                        <div key={item.id} className="flex items-center justify-between py-3 border-b border-gray-100 last:border-0">
                                            <div className="flex-1">
                                                <div className="font-medium">{item.name}</div>
                                                <div className="text-sm opacity-60">{item.price} ₽</div>
                                            </div>
                                            <div className="flex items-center gap-3 rounded-lg p-1" style={{ backgroundColor: secondaryBg }}>
                                                <button onClick={() => handleRemoveFromCart(item)} className="w-8 h-8 flex items-center justify-center bg-white rounded shadow-sm tap-effect"><IconMinus /></button>
                                                <span className="font-medium w-4 text-center">{item.quantity}</span>
                                                <button onClick={() => handleAddToCart(item)} className="w-8 h-8 flex items-center justify-center bg-white rounded shadow-sm tap-effect"><IconPlus /></button>
                                            </div>
                                        </div>
                                    ))
                                )}
                                {totalAmount > 0 && (
                                    <div className="mt-8 pt-4 border-t border-dashed border-gray-300">
                                        <div className="flex justify-between text-lg font-bold">
                                            <span>Итого</span>
                                            <span>{totalAmount} ₽</span>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
