<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Yoshiko Menu</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- –ü–û–î–ö–õ–Æ–ß–ê–ï–ú –§–ê–ô–õ–´ –ú–ï–ù–Æ -->
    <script src="menu_japan.js"></script>
    <script src="menu_hot.js"></script>
    <script src="menu_extras.js"></script>

    <style>
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .tap-effect:active { transform: scale(0.97); transition: transform 0.1s; }
        body { 
            background-color: var(--tg-theme-bg-color, #f5f5f5); 
            color: var(--tg-theme-text-color, #000000);
            -webkit-tap-highlight-color: transparent;
        }
        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        // --- –ò–ö–û–ù–ö–ò ---
        const Icons = {
            Cart: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>,
            Plus: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            Minus: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"/></svg>,
            Search: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>,
            Close: () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
            Phone: () => <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>,
            Clock: () => <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
        };

        const getPlaceholder = (category, name) => {
            const colors = { sets: '1a1a1a', rolls: 'e85d04', pizza: 'd00000', street: 'ffb703', wok: '2a9d8f' };
            const bg = colors[category] || '333';
            return `https://placehold.co/400x300/${bg}/ffffff?text=${encodeURIComponent(name.split(' ')[0])}`;
        };

        const MENU_DATA = {
            ...(window.MENU_JAPAN || {}),
            ...(window.MENU_HOT || {}),
            ...(window.MENU_EXTRAS || {})
        };

        const CATEGORIES = Object.keys(MENU_DATA).map(key => ({
            id: key,
            label: MENU_DATA[key]?.title || key
        }));

        const App = () => {
            const [activeCategory, setActiveCategory] = useState(CATEGORIES.length > 0 ? CATEGORIES[0].id : '');
            const [cart, setCart] = useState({});
            const [view, setView] = useState('menu');
            const [searchQuery, setSearchQuery] = useState('');

            useEffect(() => {
                if (window.Telegram?.WebApp) {
                    const tg = window.Telegram.WebApp;
                    tg.ready();
                    tg.expand();
                    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–≤–µ—Ç–æ–≤
                    const setVar = (name, val) => document.documentElement.style.setProperty(name, val);
                    setVar('--tg-theme-bg-color', tg.themeParams.bg_color || '#f5f5f5');
                    setVar('--tg-theme-secondary-bg-color', tg.themeParams.secondary_bg_color || '#ffffff');
                    setVar('--tg-theme-text-color', tg.themeParams.text_color || '#000000');
                    setVar('--tg-theme-button-color', tg.themeParams.button_color || '#3390ec');
                    setVar('--tg-theme-button-text-color', tg.themeParams.button_text_color || '#ffffff');
                }
            }, []);

            const totalAmount = useMemo(() => Object.values(cart).reduce((sum, item) => sum + (item.price * item.quantity), 0), [cart]);

            const handleCheckout = useCallback(() => {
                if (window.Telegram?.WebApp) {
                    const itemsList = Object.values(cart).map(i => `${i.name} x${i.quantity} - ${i.price * i.quantity}‚ÇΩ`).join('\n');
                    window.Telegram.WebApp.sendData(JSON.stringify({ cart, totalAmount, message: `–ó–∞–∫–∞–∑:\n${itemsList}\n–ò—Ç–æ–≥–æ: ${totalAmount} ‚ÇΩ` }));
                }
            }, [cart, totalAmount]);

            useEffect(() => {
                if (window.Telegram?.WebApp) {
                    const tg = window.Telegram.WebApp;
                    if (totalAmount > 0) {
                        tg.MainButton.text = `–ó–ê–ö–ê–ó–ê–¢–¨: ${totalAmount} ‚ÇΩ`;
                        tg.MainButton.show();
                        tg.MainButton.onClick(handleCheckout);
                    } else {
                        tg.MainButton.hide();
                        tg.MainButton.offClick(handleCheckout);
                    }
                }
            }, [totalAmount, handleCheckout]);

            const handleAddToCart = (item) => {
                setCart(prev => ({ ...prev, [item.id]: { ...item, quantity: (prev[item.id]?.quantity || 0) + 1 } }));
                window.Telegram?.WebApp?.HapticFeedback?.impactOccurred('medium');
            };

            const handleRemoveFromCart = (item) => {
                setCart(prev => {
                    const qty = prev[item.id]?.quantity || 0;
                    if (qty <= 1) { const n = { ...prev }; delete n[item.id]; return n; }
                    return { ...prev, [item.id]: { ...item, quantity: qty - 1 } };
                });
                window.Telegram?.WebApp?.HapticFeedback?.impactOccurred('light');
            };

            const getFilteredItems = () => {
                if (searchQuery) return Object.values(MENU_DATA).flatMap(c => c.items).filter(i => i.name.toLowerCase().includes(searchQuery.toLowerCase()));
                return MENU_DATA[activeCategory]?.items || [];
            };

            const theme = {
                bg: 'var(--tg-theme-bg-color)',
                secondaryBg: 'var(--tg-theme-secondary-bg-color)',
                text: 'var(--tg-theme-text-color)',
                button: 'var(--tg-theme-button-color)',
                buttonText: 'var(--tg-theme-button-text-color)'
            };

            return (
                <div className="min-h-screen pb-24 font-sans select-none" style={{ backgroundColor: theme.bg }}>
                    
                    {/* Header: Sticky */}
                    <div className="sticky top-0 z-50 backdrop-blur-xl bg-opacity-95 border-b border-black/5" style={{ backgroundColor: theme.secondaryBg }}>
                        
                        {/* Top Row: Logo & Cart */}
                        <div className="px-4 pt-3 pb-1 flex items-center justify-between">
                            <div className="flex items-center gap-2">
                                <div className="w-9 h-9 rounded-xl flex items-center justify-center font-bold text-white shadow-sm shadow-blue-500/20"
                                     style={{ backgroundColor: theme.button }}>Y</div>
                                <h1 className="text-xl font-bold tracking-tight" style={{ color: theme.text }}>Yoshiko</h1>
                            </div>
                            <div className="relative cursor-pointer tap-effect p-2" onClick={() => setView(view === 'cart' ? 'menu' : 'cart')}>
                                {view === 'cart' ? <Icons.Close /> : <Icons.Cart />}
                                {Object.keys(cart).length > 0 && view !== 'cart' && (
                                    <span className="absolute top-1 right-1 bg-red-500 text-white text-[10px] font-bold rounded-full w-4 h-4 flex items-center justify-center border border-white">{Object.values(cart).reduce((a,b) => a + b.quantity, 0)}</span>
                                )}
                            </div>
                        </div>

                        {/* --- –ò–ù–§–û–†–ú–ê–¶–ò–û–ù–ù–´–ô –ë–õ–û–ö (–ù–û–í–´–ô) --- */}
                        {view === 'menu' && (
                            <div className="px-4 pb-3 animate-fade-in">
                                <div className="flex flex-col gap-1 pl-1">
                                    <a href="tel:+74993479141" className="text-[12px] font-semibold flex items-center gap-1.5 opacity-80 hover:opacity-100 transition-opacity" style={{ color: theme.text }}>
                                        <Icons.Phone /> <span>+7 (499) 347 91 41</span>
                                    </a>
                                    <div className="text-[10px] flex items-center gap-1.5 opacity-50 font-medium" style={{ color: theme.text }}>
                                        <Icons.Clock /> 
                                        <span>–ë—É–¥–Ω–∏ 10:30-00:00 <span className="mx-1 opacity-30">|</span> –í—ã—Ö 10:30-01:00</span>
                                    </div>
                                </div>
                            </div>
                        )}
                        {/* ---------------------------------- */}

                        {view === 'menu' && (
                            <>
                                <div className="px-4 pb-2">
                                    <div className="relative group">
                                        <div className="absolute left-3 top-2.5 text-gray-400"><Icons.Search /></div>
                                        <input type="text" placeholder="–ü–æ–∏—Å–∫ –±–ª—é–¥..." value={searchQuery} onChange={(e) => setSearchQuery(e.target.value)}
                                            className="w-full pl-10 pr-4 py-2.5 rounded-xl text-[14px] outline-none shadow-sm transition-all focus:shadow-md" 
                                            style={{ backgroundColor: theme.bg, color: theme.text }} />
                                    </div>
                                </div>
                                {!searchQuery && (
                                    <div className="flex overflow-x-auto hide-scrollbar px-4 pb-3 gap-2">
                                        {CATEGORIES.map(cat => (
                                            <button key={cat.id} onClick={() => setActiveCategory(cat.id)}
                                                className={`whitespace-nowrap px-4 py-2 rounded-full text-[13px] font-medium transition-all tap-effect ${activeCategory === cat.id ? 'shadow-md scale-[1.02]' : 'opacity-60'}`}
                                                style={{ backgroundColor: activeCategory === cat.id ? theme.button : theme.bg, color: activeCategory === cat.id ? theme.buttonText : theme.text }}>
                                                {cat.label}
                                            </button>
                                        ))}
                                    </div>
                                )}
                            </>
                        )}
                    </div>

                    {/* Main Content */}
                    <div className="p-4 animate-fade-in">
                        {view === 'menu' ? (
                            <div className="grid grid-cols-2 gap-3">
                                {searchQuery && <h2 className="col-span-full font-bold mb-2">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞:</h2>}
                                {getFilteredItems().map(item => (
                                    <div key={item.id} className="flex flex-col rounded-[20px] overflow-hidden shadow-sm border border-black/5 relative tap-effect h-full" style={{ backgroundColor: theme.secondaryBg }}>
                                        <div className="w-full aspect-[4/3] relative bg-gray-100 overflow-hidden group">
                                            <img src={item.image || getPlaceholder(activeCategory, item.name)} className="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105" loading="lazy" />
                                            {item.count && <span className="absolute bottom-2 left-2 bg-black/60 backdrop-blur-md text-white text-[10px] px-2 py-0.5 rounded-md font-medium">{item.count}</span>}
                                            {item.weight && <span className="absolute bottom-2 right-2 bg-white/90 backdrop-blur-md text-black text-[10px] px-2 py-0.5 rounded-md shadow-sm font-medium">{item.weight}</span>}
                                        </div>
                                        <div className="p-3 flex flex-col flex-1 justify-between">
                                            <div>
                                                <h3 className="font-bold text-[13px] leading-[1.3] mb-1 line-clamp-2" style={{ color: theme.text }}>{item.name}</h3>
                                                <p className="text-[11px] leading-[1.3] line-clamp-2 mb-3 opacity-60" style={{ color: theme.text }}>{item.description}</p>
                                            </div>
                                            <div className="flex items-center justify-between mt-auto">
                                                <span className="font-bold text-[15px]" style={{ color: theme.text }}>{item.price} ‚ÇΩ</span>
                                                {cart[item.id] ? (
                                                    <div className="flex items-center rounded-full bg-gray-100 dark:bg-white/10 h-8">
                                                        <button onClick={() => handleRemoveFromCart(item)} className="w-8 h-8 flex items-center justify-center tap-effect"><Icons.Minus /></button>
                                                        <span className="text-[13px] font-semibold min-w-[16px] text-center" style={{ color: theme.text }}>{cart[item.id].quantity}</span>
                                                        <button onClick={() => handleAddToCart(item)} className="w-8 h-8 flex items-center justify-center tap-effect"><Icons.Plus /></button>
                                                    </div>
                                                ) : (
                                                    <button onClick={() => handleAddToCart(item)} className="w-8 h-8 rounded-full flex items-center justify-center shadow-sm tap-effect transition-colors" style={{ backgroundColor: theme.button, color: theme.buttonText }}><Icons.Plus /></button>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div className="space-y-4 animate-fade-in">
                                <div className="flex items-center justify-between mb-4">
                                    <h2 className="text-2xl font-bold" style={{ color: theme.text }}>–ö–æ—Ä–∑–∏–Ω–∞</h2>
                                    <button onClick={() => setCart({})} className="text-red-500 text-[14px] font-medium opacity-80 hover:opacity-100">–û—á–∏—Å—Ç–∏—Ç—å</button>
                                </div>
                                {Object.keys(cart).length === 0 ? <div className="text-center py-20 opacity-40"><div className="text-6xl mb-4">üõí</div><p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p><button onClick={() => setView('menu')} className="mt-4 text-blue-500 font-medium">–ü–µ—Ä–µ–π—Ç–∏ –≤ –º–µ–Ω—é</button></div> : 
                                    Object.values(cart).map(item => (
                                        <div key={item.id} className="flex items-center gap-4 py-3 border-b border-black/5 last:border-0">
                                            <div className="w-16 h-16 rounded-xl bg-gray-100 overflow-hidden shrink-0"><img src={item.image || getPlaceholder('cart', item.name)} className="w-full h-full object-cover" /></div>
                                            <div className="flex-1 min-w-0">
                                                <div className="font-medium truncate text-[14px]" style={{ color: theme.text }}>{item.name}</div>
                                                <div className="text-[13px] opacity-60" style={{ color: theme.text }}>{item.price} ‚ÇΩ</div>
                                            </div>
                                            <div className="flex items-center gap-3 rounded-lg px-2 py-1" style={{ backgroundColor: theme.bg }}>
                                                <button onClick={() => handleRemoveFromCart(item)} className="p-1 opacity-60"><Icons.Minus /></button>
                                                <span className="font-medium w-4 text-center text-[14px]" style={{ color: theme.text }}>{item.quantity}</span>
                                                <button onClick={() => handleAddToCart(item)} className="p-1 opacity-60"><Icons.Plus /></button>
                                            </div>
                                        </div>
                                    ))
                                }
                            </div>
                        )}
                    </div>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
